<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S56T7U519">localA</span> = localAssemblingSVK(<span class="var type1" id="S57T44U522">stress</span>,<span class="var type1" id="S58T43U523">gradientMatBase</span>,<span class="var type1" id="S59T12U524">trafo</span>,<span class="var type1" id="S60T38U525">weights</span>,<span class="var type1" id="S61T2U526">Mu</span>,<span class="var type1" id="S62T2U527">Lambda</span>,<span class="var type1" id="S63T45U528">grad_u0</span>,<span class="var type1" id="S64T45U529">sigma_u0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">    <span class="mxinfo" id="T2:U10"><span class="var type1" id="S65T2U532">N</span> = <span class="mxinfo" id="T2:U12">length(<span class="var type1" id="S60T38U535">weights</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S67T2U538">i</span>=<span class="mxinfo" id="T2:U15">1</span>:<span class="var type1" id="S65T2U541">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%          fun1 = @(block_struct) getStressSVK(block_struct.data*(trafo(:,2*i-1:2*i)\eye(2)),Mu,Lambda,grad_u0(:,2*i-1:2*i),sigma_u0(:,2*i-1:2*i))'*<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%                                                  abs(det(trafo(:,2*i-1:2*i)))   *   weights(i);                                    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%         stress(:,2*i-1:2*i) = blockproc(stress(:,2*i-1:2*i),[2 2],fun1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="mxinfo" id="T11:U17"><span class="mxinfo" id="T11:U18"><span class="var type1" id="S57T44U545">stress</span>(:,<span class="mxinfo" id="T49:U20"><span class="mxinfo" id="T2:U21"><span class="mxinfo" id="T2:U22">2</span>*<span class="var type1" id="S67T2U551">i</span>-1</span>:<span class="mxinfo" id="T2:U24">2</span>*<span class="var type1" id="S67T2U555">i</span></span>)</span> = <span class="mxinfo" id="T11:U26"><span class="fcn" id="F214N14:B557">strain2Stress</span>(<span class="mxinfo" id="T11:U27"><span class="var type1" id="S57T44U559">stress</span>(:,<span class="mxinfo" id="T49:U29"><span class="mxinfo" id="T2:U30"><span class="mxinfo" id="T2:U31">2</span>*<span class="var type1" id="S67T2U565">i</span>-1</span>:<span class="mxinfo" id="T2:U33">2</span>*<span class="var type1" id="S67T2U569">i</span></span>)</span>,<span class="mxinfo" id="T12:U35"><span class="var type1" id="S59T12U571">trafo</span>(:,<span class="mxinfo" id="T49:U37"><span class="mxinfo" id="T2:U38"><span class="mxinfo" id="T2:U39">2</span>*<span class="var type1" id="S67T2U577">i</span>-1</span>:<span class="mxinfo" id="T2:U41">2</span>*<span class="var type1" id="S67T2U581">i</span></span>)</span>,<span class="var type1" id="S61T2U582">Mu</span>,<span class="var type1" id="S62T2U583">Lambda</span>,<span class="mxinfo" id="T12:U45"><span class="var type1" id="S63T45U585">grad_u0</span>(:,<span class="mxinfo" id="T49:U47"><span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49">2</span>*<span class="var type1" id="S67T2U591">i</span>-1</span>:<span class="mxinfo" id="T2:U51">2</span>*<span class="var type1" id="S67T2U595">i</span></span>)</span>,<span class="mxinfo" id="T12:U53"><span class="var type1" id="S64T45U597">sigma_u0</span>(:,<span class="mxinfo" id="T49:U55"><span class="mxinfo" id="T2:U56"><span class="mxinfo" id="T2:U57">2</span>*<span class="var type1" id="S67T2U603">i</span>-1</span>:<span class="mxinfo" id="T2:U59">2</span>*<span class="var type1" id="S67T2U607">i</span></span>)</span>,<span class="mxinfo" id="T2:U61"><span class="var type1" id="S60T38U609">weights</span>(<span class="var type1" id="S67T2U610">i</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%         fun2 = @(block_struct) 0.5*(block_struct.data*(trafo(:,2*i-1:2*i)\eye(2))+(block_struct.data*(trafo(:,2*i-1:2*i)\eye(2)))');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%         gradientMatBase(2*i-1:2*i,:) = blockproc(gradientMatBase(2*i-1:2*i,:),[2 2],fun2);       </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="mxinfo" id="T4:U64"><span class="mxinfo" id="T4:U65"><span class="var type1" id="S58T43U614">gradientMatBase</span>(<span class="mxinfo" id="T49:U67"><span class="mxinfo" id="T2:U68"><span class="mxinfo" id="T2:U69">2</span>*<span class="var type1" id="S67T2U619">i</span>-1</span>:<span class="mxinfo" id="T2:U71">2</span>*<span class="var type1" id="S67T2U623">i</span></span>,:)</span> = <span class="mxinfo" id="T4:U73"><span class="fcn" id="F215N16:B626">symmetrizeStrain</span>(<span class="mxinfo" id="T4:U74"><span class="var type1" id="S58T43U628">gradientMatBase</span>(<span class="mxinfo" id="T49:U76"><span class="mxinfo" id="T2:U77"><span class="mxinfo" id="T2:U78">2</span>*<span class="var type1" id="S67T2U633">i</span>-1</span>:<span class="mxinfo" id="T2:U80">2</span>*<span class="var type1" id="S67T2U637">i</span></span>,:)</span>,<span class="mxinfo" id="T12:U82"><span class="var type1" id="S59T12U640">trafo</span>(:,<span class="mxinfo" id="T49:U84"><span class="mxinfo" id="T2:U85"><span class="mxinfo" id="T2:U86">2</span>*<span class="var type1" id="S67T2U646">i</span>-1</span>:<span class="mxinfo" id="T2:U88">2</span>*<span class="var type1" id="S67T2U650">i</span></span>)</span>)</span></span>; <span class="comment">% do not do it for nonlinear method (see subfunction)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%     fun = @(block_struct) block_struct.data';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%     stress = blockproc(stress,[2 2],fun);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">%stress = stressTranspose(stress);   % &lt;----- do not do it twice</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">    <span class="mxinfo" id="T7:U90"><span class="var type1" id="S70T7U653">mat</span> = <span class="mxinfo" id="T7:U92"><span class="var type1" id="S57T44U655">stress</span>*<span class="var type1" id="S58T43U656">gradientMatBase</span></span></span>; <span class="comment">% stress - times - test-strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">%     fun = @(block_struct) [trace(block_struct.data(1:2,1:2)) trace(block_struct.data(3:4,1:2));trace(block_struct.data(1:2,3:4)) trace(block_struct.data(3:4,3:4))];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">%     localA = blockproc(mat,[4 4],fun);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo" id="T7:U95"><span class="var type1" id="S56T7U659">localA</span> = <span class="mxinfo" id="T7:U97"><span class="fcn" id="F228N13:B661">matrixTraceFunA</span>(<span class="var type1" id="S70T7U662">mat</span>)</span></span>; <span class="comment">%assemble2by2Blocks(mat);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"></span></span>
</pre>
