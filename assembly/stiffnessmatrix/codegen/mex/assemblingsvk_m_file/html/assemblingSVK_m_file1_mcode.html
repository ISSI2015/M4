<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T7U3">A</span>, <span class="var type1" id="S3T9U4">F</span> ] = assemblingSVK_m_file( <span class="var type1" id="S4T1U7">DOF</span>, <span class="var type1" id="S5T11U8">trafo</span>, <span class="var type1" id="S6T4U9">pAll</span>, <span class="var type1" id="S7T8U10">t</span>, <span class="var type1" id="S8T6U11">gradientMatBase0</span>, <span class="var type1" id="S9T2U12">lengthBasis</span>, <span class="var type1" id="S10T5U13">points</span>, <span class="var type1" id="S11T38U14">weights</span>, <span class="var type1" id="S12T9U15">u0</span>, <span class="var type1" id="S13T37U16">matConst</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line">    <span class="mxinfo" id="T3:U13"><span class="var type1" id="S14T3U19">positions</span> = <span class="mxinfo" id="T3:U15"><span class="fcn" id="F6N3:B21">getGlobalPositions</span>(<span class="var type1" id="S4T1U22">DOF</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line">    <span class="mxinfo" id="T7:U17"><span class="var type1" id="S2T7U25">A</span> = <span class="mxinfo" id="T7:U19">zeros(<span class="mxinfo" id="T2:U20"><span class="mxinfo" id="T2:U21">2</span>*<span class="mxinfo" id="T2:U22">size(<span class="var type1" id="S6T4U32">pAll</span>,2)</span></span>,<span class="mxinfo" id="T2:U24"><span class="mxinfo" id="T2:U25">2</span>*<span class="mxinfo" id="T2:U26">size(<span class="var type1" id="S6T4U38">pAll</span>,2)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line">    <span class="mxinfo" id="T9:U28"><span class="var type1" id="S3T9U42">F</span> = <span class="mxinfo" id="T9:U30">zeros(<span class="mxinfo" id="T2:U31"><span class="mxinfo" id="T2:U32">2</span>*<span class="mxinfo" id="T2:U33">size(<span class="var type1" id="S6T4U49">pAll</span>,2)</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line">    <span class="mxinfo" id="T43:U35"><span class="var type1" id="S18T43U54">gradientMatBase</span> = <span class="mxinfo" id="T43:U37">zeros(<span class="mxinfo" id="T2:U38"><span class="mxinfo" id="T2:U39">2</span>*<span class="mxinfo" id="T2:U40">size(<span class="var type1" id="S10T5U61">points</span>,2)</span></span>,<span class="mxinfo" id="T2:U42"><span class="mxinfo" id="T2:U43">4</span>*<span class="var type1" id="S9T2U65">lengthBasis</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line">    <span class="mxinfo" id="T44:U45"><span class="var type1" id="S19T44U68">stress</span> = <span class="mxinfo" id="T44:U47">zeros(<span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49">4</span>*<span class="var type1" id="S9T2U73">lengthBasis</span></span>,<span class="mxinfo" id="T2:U51"><span class="mxinfo" id="T2:U52">2</span>*<span class="mxinfo" id="T2:U53">size(<span class="var type1" id="S10T5U78">points</span>,2)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S20T2U82">j</span>=<span class="mxinfo" id="T2:U56">1</span>:<span class="mxinfo" id="T2:U57">size(<span class="var type1" id="S10T5U87">points</span>,2)</span> <span class="comment">% index of evaluation point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S21T2U91">i</span>=<span class="mxinfo" id="T2:U60">1</span>:<span class="var type1" id="S9T2U94">lengthBasis</span> <span class="comment">% index of base function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line">                <span class="mxinfo" id="T48:U62"><span class="mxinfo" id="T48:U63"><span class="var type1" id="S18T43U98">gradientMatBase</span>(<span class="mxinfo" id="T49:U65">(<span class="mxinfo" id="T2:U66"><span class="mxinfo" id="T2:U67">2</span>*<span class="var type1" id="S20T2U104">j</span>-1</span>):<span class="mxinfo" id="T2:U69">2</span>*<span class="var type1" id="S20T2U108">j</span></span>,<span class="mxinfo" id="T32:U71">(<span class="mxinfo" id="T2:U72"><span class="mxinfo" id="T2:U73">4</span>*<span class="var type1" id="S21T2U114">i</span>-3</span>):<span class="mxinfo" id="T2:U75">4</span>*<span class="var type1" id="S21T2U118">i</span></span>)</span> = <span class="mxinfo" id="T48:U77">[<span class="mxinfo" id="T50:U78"><span class="mxinfo" id="T2:U79"><span class="var type1" id="S8T6U122">gradientMatBase0</span>(<span class="var type1" id="S21T2U123">i</span>,<span class="var type1" id="S20T2U124">j</span>,<span class="mxinfo" id="T2:U83">1</span>)</span> <span class="mxinfo" id="T2:U84"><span class="var type1" id="S8T6U127">gradientMatBase0</span>(<span class="var type1" id="S21T2U128">i</span>,<span class="var type1" id="S20T2U129">j</span>,<span class="mxinfo" id="T2:U88">2</span>)</span> <span class="mxinfo" id="T2:U89">0</span> <span class="mxinfo" id="T2:U90">0</span></span>;<span class="mxinfo" id="T50:U91"><span class="mxinfo" id="T2:U92">0</span> <span class="mxinfo" id="T2:U93">0</span> <span class="mxinfo" id="T2:U94"><span class="var type1" id="S8T6U137">gradientMatBase0</span>(<span class="var type1" id="S21T2U138">i</span>,<span class="var type1" id="S20T2U139">j</span>,<span class="mxinfo" id="T2:U98">1</span>)</span> <span class="mxinfo" id="T2:U99"><span class="var type1" id="S8T6U142">gradientMatBase0</span>(<span class="var type1" id="S21T2U143">i</span>,<span class="var type1" id="S20T2U144">j</span>,<span class="mxinfo" id="T2:U103">2</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line">                <span class="mxinfo" id="T12:U104"><span class="mxinfo" id="T12:U105"><span class="var type1" id="S19T44U149">stress</span>(<span class="mxinfo" id="T49:U107"><span class="mxinfo" id="T2:U108"><span class="mxinfo" id="T2:U109">4</span>*<span class="var type1" id="S21T2U154">i</span>-3</span>:<span class="mxinfo" id="T2:U111"><span class="mxinfo" id="T2:U112">4</span>*<span class="var type1" id="S21T2U159">i</span>-2</span></span>,<span class="mxinfo" id="T49:U114"><span class="mxinfo" id="T2:U115"><span class="mxinfo" id="T2:U116">2</span>*<span class="var type1" id="S20T2U165">j</span>-1</span>:<span class="mxinfo" id="T2:U118">2</span>*<span class="var type1" id="S20T2U169">j</span></span>)</span> = <span class="mxinfo" id="T12:U120"><span class="var type1" id="S18T43U171">gradientMatBase</span>(<span class="mxinfo" id="T49:U122"><span class="mxinfo" id="T2:U123"><span class="mxinfo" id="T2:U124">2</span>*<span class="var type1" id="S20T2U176">j</span>-1</span>:<span class="mxinfo" id="T2:U126">2</span>*<span class="var type1" id="S20T2U180">j</span></span>,<span class="mxinfo" id="T49:U128"><span class="mxinfo" id="T2:U129"><span class="mxinfo" id="T2:U130">4</span>*<span class="var type1" id="S21T2U185">i</span>-3</span>:<span class="mxinfo" id="T2:U132"><span class="mxinfo" id="T2:U133">4</span>*<span class="var type1" id="S21T2U190">i</span>-2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line">                <span class="mxinfo" id="T12:U135"><span class="mxinfo" id="T12:U136"><span class="var type1" id="S19T44U195">stress</span>(<span class="mxinfo" id="T49:U138"><span class="mxinfo" id="T2:U139"><span class="mxinfo" id="T2:U140">4</span>*<span class="var type1" id="S21T2U200">i</span>-1</span>:<span class="mxinfo" id="T2:U142">4</span>*<span class="var type1" id="S21T2U204">i</span></span>,<span class="mxinfo" id="T49:U144"><span class="mxinfo" id="T2:U145"><span class="mxinfo" id="T2:U146">2</span>*<span class="var type1" id="S20T2U209">j</span>-1</span>:<span class="mxinfo" id="T2:U148">2</span>*<span class="var type1" id="S20T2U213">j</span></span>)</span> = <span class="mxinfo" id="T12:U150"><span class="var type1" id="S18T43U215">gradientMatBase</span>(<span class="mxinfo" id="T49:U152"><span class="mxinfo" id="T2:U153"><span class="mxinfo" id="T2:U154">2</span>*<span class="var type1" id="S20T2U220">j</span>-1</span>:<span class="mxinfo" id="T2:U156">2</span>*<span class="var type1" id="S20T2U224">j</span></span>,<span class="mxinfo" id="T49:U158"><span class="mxinfo" id="T2:U159"><span class="mxinfo" id="T2:U160">4</span>*<span class="var type1" id="S21T2U229">i</span>-1</span>:<span class="mxinfo" id="T2:U162">4</span>*<span class="var type1" id="S21T2U233">i</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S22T2U236">count</span>=<span class="mxinfo" id="T2:U165">1</span>:<span class="mxinfo" id="T2:U166">size(<span class="var type1" id="S7T8U241">t</span>,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">            <span class="mxinfo" id="T10:U168"><span class="var type1" id="S23T10U245">u0_loc</span> = <span class="mxinfo" id="T10:U170"><span class="var type1" id="S12T9U247">u0</span>(<span class="mxinfo" id="T51:U172"><span class="var type1" id="S14T3U249">positions</span>(<span class="var type1" id="S22T2U250">count</span>,:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line">            <span class="mxinfo" id="T45:U175"><span class="var type1" id="S24T45U254">grad_u0</span> = <span class="mxinfo" id="T45:U177"><span class="fcn" id="F130N5:B256">giveGradient</span>(<span class="var type1" id="S19T44U257">stress</span>,<span class="var type1" id="S23T10U258">u0_loc</span>,<span class="mxinfo" id="T12:U180"><span class="var type1" id="S5T11U260">trafo</span>(<span class="mxinfo" id="T49:U182"><span class="mxinfo" id="T2:U183"><span class="mxinfo" id="T2:U184">2</span>*<span class="var type1" id="S22T2U265">count</span>-1</span>:<span class="mxinfo" id="T2:U186">2</span>*<span class="var type1" id="S22T2U269">count</span></span>,:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line">            <span class="mxinfo" id="T45:U188"><span class="var type1" id="S26T45U273">sigma_u0</span> = <span class="mxinfo" id="T45:U190"><span class="fcn" id="F143N6:B275">giveSigma</span>(<span class="var type1" id="S24T45U276">grad_u0</span>,<span class="mxinfo" id="T2:U192"><span class="var type1" id="S13T37U278">matConst</span>.Mu</span>,<span class="mxinfo" id="T2:U194"><span class="var type1" id="S13T37U281">matConst</span>.Lambda</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">            <span class="mxinfo" id="T7:U196"><span class="var type1" id="S28T7U285">localA</span> = <span class="mxinfo" id="T7:U198"><span class="fcn" id="F229N10:B287">localAssemblingSVK</span>(<span class="var type1" id="S19T44U288">stress</span>,<span class="var type1" id="S18T43U289">gradientMatBase</span>,<span class="mxinfo" id="T12:U201"><span class="var type1" id="S5T11U291">trafo</span>(<span class="mxinfo" id="T49:U203"><span class="mxinfo" id="T2:U204"><span class="mxinfo" id="T2:U205">2</span>*<span class="var type1" id="S22T2U296">count</span>-1</span>:<span class="mxinfo" id="T2:U207">2</span>*<span class="var type1" id="S22T2U300">count</span></span>,:)</span>,<span class="var type1" id="S11T38U302">weights</span>,<span class="mxinfo" id="T2:U210"><span class="var type1" id="S13T37U304">matConst</span>.Mu</span>,<span class="mxinfo" id="T2:U212"><span class="var type1" id="S13T37U307">matConst</span>.Lambda</span>,<span class="var type1" id="S24T45U309">grad_u0</span>,<span class="var type1" id="S26T45U310">sigma_u0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">            <span class="mxinfo" id="T36:U216"><span class="var type1" id="S30T36U313">localF</span> = <span class="mxinfo" id="T36:U218"><span class="fcn" id="F268N9:B315">localAssemblingF</span>(<span class="var type1" id="S24T45U316">grad_u0</span>,<span class="var type1" id="S26T45U317">sigma_u0</span>,<span class="var type1" id="S18T43U318">gradientMatBase</span>,<span class="mxinfo" id="T12:U222"><span class="var type1" id="S5T11U320">trafo</span>(<span class="mxinfo" id="T49:U224"><span class="mxinfo" id="T2:U225"><span class="mxinfo" id="T2:U226">2</span>*<span class="var type1" id="S22T2U325">count</span>-1</span>:<span class="mxinfo" id="T2:U228">2</span>*<span class="var type1" id="S22T2U329">count</span></span>,:)</span>,<span class="var type1" id="S11T38U331">weights</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line">            <span class="mxinfo" id="T52:U231"><span class="mxinfo" id="T52:U232"><span class="var type1" id="S2T7U335">A</span>(<span class="mxinfo" id="T51:U234"><span class="var type1" id="S14T3U337">positions</span>(<span class="var type1" id="S22T2U338">count</span>,:)</span>,<span class="mxinfo" id="T51:U237"><span class="var type1" id="S14T3U341">positions</span>(<span class="var type1" id="S22T2U342">count</span>,:)</span>)</span> = <span class="mxinfo" id="T52:U240"><span class="mxinfo" id="T52:U241"><span class="var type1" id="S2T7U346">A</span>(<span class="mxinfo" id="T51:U243"><span class="var type1" id="S14T3U348">positions</span>(<span class="var type1" id="S22T2U349">count</span>,:)</span>,<span class="mxinfo" id="T51:U246"><span class="var type1" id="S14T3U352">positions</span>(<span class="var type1" id="S22T2U353">count</span>,:)</span>)</span> + <span class="var type1" id="S28T7U355">localA</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">            <span class="mxinfo" id="T51:U250"><span class="mxinfo" id="T51:U251"><span class="var type1" id="S3T9U359">F</span>(<span class="mxinfo" id="T51:U253"><span class="var type1" id="S14T3U361">positions</span>(<span class="var type1" id="S22T2U362">count</span>,:)</span>)</span> = <span class="mxinfo" id="T10:U256"><span class="mxinfo" id="T10:U257"><span class="var type1" id="S3T9U366">F</span>(<span class="mxinfo" id="T51:U259"><span class="var type1" id="S14T3U368">positions</span>(<span class="var type1" id="S22T2U369">count</span>,:)</span>)</span> + <span class="mxinfo" id="T9:U262"><span class="var type1" id="S30T36U372">localF</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
</pre>
